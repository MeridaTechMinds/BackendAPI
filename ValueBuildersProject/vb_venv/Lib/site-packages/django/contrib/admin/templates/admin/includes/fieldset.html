<fieldset class="module aligned {{ fieldset.classes }}">
    {% if fieldset.name %}<h2>{{ fieldset.name }}</h2>{% endif %}
    {% if fieldset.description %}
        <div class="description">{{ fieldset.description|safe }}</div>
    {% endif %}
    {% for line in fieldset %}
        <div class="form-row{% if line.fields|length == 1 and line.errors %} errors{% endif %}{% if not line.has_visible_field %} hidden{% endif %}{% for field in line %}{% if field.field.name %} field-{{ field.field.name }}{% endif %}{% endfor %}">
            {% if line.fields|length == 1 %}{{ line.errors }}{% else %}<div class="flex-container form-multiline">{% endif %}
            {% for field in line %}
                <div>
                    {% if not line.fields|length == 1 and not field.is_readonly %}{{ field.errors }}{% endif %}
                        <div class="flex-container{% if not line.fields|length == 1 %} fieldBox{% if field.field.name %} field-{{ field.field.name }}{% endif %}{% if not field.is_readonly and field.errors %} errors{% endif %}{% if field.field.is_hidden %} hidden{% endif %}{% elif field.is_checkbox %} checkbox-row{% endif %}">
                            {% if field.is_checkbox %}
                                {{ field.field }}{{ field.label_tag }}
                            {% else %}
                                {{ field.label_tag }}
                                {% if field.is_readonly %}
                                    <div class="readonly">{{ field.contents }}</div>
                                {% else %}
                                    {{ field.field }}
                                {% endif %}
                            {% endif %}
                        </div>
                    {% if field.field.help_text %}
                        <div class="help"{% if field.field.id_for_label %} id="{{ field.field.id_for_label }}_helptext"{% endif %}>
                            <div>{{ field.field.help_text|safe }}</div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            {% if not line.fields|length == 1 %}</div>{% endif %}
        </div>
    {% endfor %}
</fieldset>
<!-- Add this script after your Django admin form HTML code -->
<!-- Add this script after the previous JavaScript code -->


{% comment %} <script>
    document.addEventListener("DOMContentLoaded", function () {
        // Get the state field element
        var stateField = document.getElementById("id_state"); // Replace "id_state" with the actual ID of your state field
        var districtField = document.getElementById("id_District"); // Replace "id_district" with the actual ID of your district dropdown

        // Add an event listener to the state field
        stateField.addEventListener("change", function () {
            // Get the selected value from the state field
            var selectedValue = stateField.value;

            // Log the selected value to the console
            console.log("Selected State:", selectedValue);

            // Function to fetch districts based on the selected state from the API
            function getDistricts(stateName) {
                var api_url = "http://api.nightlights.io/districts";

                // Fetch data from the API
                return fetch(api_url)
                    .then(function (response) {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(function (data) {
                        // Extract districts for the specified state from the API response
                        var districts = [];

                        data.regions.forEach(function (region) {
                            if (region.state_name === stateName) {
                                var districtName = region.district_name;
                                districts.push([(districtName, districtName)]);
                            }
                        });

                        return districts;
                    });
            }

            // Example usage
            getDistricts(selectedValue)
                .then(function (districts) {
                    console.log("Districts:", districts);

                    // Clear existing options in the district dropdown
                    districtField.innerHTML = '';

                    // Populate the district dropdown with new options
                    districts.forEach(function (district) {
                        var option = document.createElement("option");
                        option.value = district[0];
                        option.text = district[1];
                        districtField.add(option);
                    });
                })
                .catch(function (error) {
                    console.error("Error fetching districts:", error);
                });
        });
    });
</script>  {% endcomment %}